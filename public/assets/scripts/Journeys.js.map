{"version":3,"sources":["Journeys.coffee"],"names":[],"mappings":"AAAA;EAAA,CAAA,CAAE,QAAF,CAAW,CAAC,KAAZ,CAAkB,SAAA;AAEhB,QAAA;IAAA,CAAA,CAAE,OAAF,CAAU,CAAC,OAAX,CAAmB,SAAA;aACjB;QAAA,YAAA,EAAc,YAAd;QACA,WAAA,EAAa,GADb;;IADiB,CAAnB;IAKA,CAAA,CAAE,cAAF,CAAiB,CAAC,KAAlB,CAAwB,SAAC,KAAD;AACtB,UAAA;MAAA,YAAA,GAAe,CAAA,CAAE,KAAK,CAAC,MAAR,CAAe,CAAC,OAAhB,CAAwB,cAAxB,CAAuC,CAAC,IAAxC,CAA6C,cAA7C;aACf,CAAC,CAAC,IAAF,CAAO,iBAAA,GAAoB,YAA3B,EACE;QAAA,MAAA,EAAQ,MAAR;QACA,OAAA,EAAS,SAAA;iBACP,OAAO,CAAC,GAAR,CAAY,QAAZ;QADO,CADT;OADF;IAFsB,CAAxB;IASA,gBAAA,GAAmB;IACnB,gBAAA,IAAoB;IACpB,gBAAA,IAAoB;IACpB,gBAAA,IAAoB;IACpB,gBAAA,IAAoB,MAAA,GAAS,CAAC,CAAC,MAAM,CAAC,MAAP,GAAgB,CAAjB,CAAA,GAAsB,CAAC,GAAA,GAAM,CAAP,CAAvB;IAC7B,gBAAA,IAAoB;IACpB,gBAAA,IAAoB,OAAA,GAAU,CAAC,CAAC,MAAM,CAAC,KAAP,GAAe,CAAhB,CAAA,GAAqB,CAAC,GAAA,GAAM,CAAP,CAAtB;IAG9B,CAAC,CAAC,SAAF,CAAY;MAAA,KAAA,EAAO,IAAP;KAAZ;IACA,CAAC,CAAC,SAAF,CAAY,0CAAZ,EAAwD,SAAA;MACtD,EAAE,CAAC,IAAH,CACE;QAAA,KAAA,EAAO,kBAAP;QACA,OAAA,EAAS,MADT;OADF;MAGA,CAAA,CAAE,0BAAF,CAA6B,CAAC,UAA9B,CAAyC,UAAzC;aACA,EAAE,CAAC,cAAH,CAAkB,SAAC,QAAD;eAEhB,CAAA,CAAE,sBAAF,CAAyB,CAAC,KAA1B,CAAgC,SAAA;AAG9B,cAAA;UAAA,YAAA,GAAe,CAAA,CAAE,IAAF,CACb,CAAC,OADY,CACJ,cADI,CAEb,CAAC,IAFY,CAEP,cAFO;UAGf,KAAA,GAAQ,CAAA,CAAE,IAAF,CACN,CAAC,OADK,CACG,cADH,CAEN,CAAC,QAFK,CAEI,gBAFJ,CAGN,CAAC,QAHK,CAGI,WAHJ,CAIN,CAAC,QAJK,CAII,MAJJ,CAKN,CAAC,IALK,CAAA;UAMR,OAAA,GAAU,CAAA,CAAE,IAAF,CACR,CAAC,OADO,CACC,cADD,CAER,CAAC,QAFO,CAEE,eAFF,CAGR,CAAC,QAHO,CAGE,gBAHF,CAIR,CAAC,QAJO,CAIE,IAJF,CAKR,CAAC,QALO,CAKE,GALF,CAMR,CAAC,IANO,CAAA,CAOR,CAAC,IAPO,CAAA;UAQV,YAAA,GAAe,CAAA,CAAE,IAAF,CACb,CAAC,OADY,CACJ,cADI,CAEb,CAAC,QAFY,CAEH,SAFG,CAGb,CAAC,QAHY,CAGH,KAHG,CAIb,CAAC,IAJY,CAIP,KAJO;UAKf,WAAA,GAAc,CAAA,CAAE,IAAF,CACZ,CAAC,OADW,CACH,cADG,CAEZ,CAAC,QAFW,CAEF,eAFE,CAGZ,CAAC,QAHW,CAGF,UAHE,CAIZ,CAAC,IAJW,CAAA,CAKZ,CAAC,IALW,CAAA;iBAQd,EAAE,CAAC,EAAH,CACE;YAAA,MAAA,EAAQ,MAAR;YACA,IAAA,EAAM,wCAAA,GAA2C,YADjD;YAEA,IAAA,EAAM,OAAA,GAAU,iBAAV,GAA8B,KAFpC;YAGA,WAAA,EAAa,WAHb;YAIA,OAAA,EAAS,qCAAA,GAAwC,YAJjD;WADF;QAjC8B,CAAhC;MAFgB,CAAlB;IALsD,CAAxD;IAgDA,CAAA,CAAE,qBAAF,CAAwB,CAAC,KAAzB,CAA+B,SAAA;AAC7B,UAAA;MAAA,UAAA,GAAa,CAAA,CAAE,IAAF,CAAO,CAAC,IAAR,CAAa,aAAb;aACb,MAAM,CAAC,IAAP,CAAY,UAAZ,EAAwB,0BAAxB,EAAoD,gBAApD;IAF6B,CAA/B;IAKA,CAAC,CAAC,SAAF,CAAY,oCAAZ,EAAkD,SAAA;MAGhD,CAAA,CAAE,uBAAF,CAA0B,CAAC,KAA3B,CAAiC,SAAA;AAS/B,YAAA;QAAA,YAAA,GAAe,CAAA,CAAE,IAAF,CACb,CAAC,OADY,CACJ,cADI,CAEb,CAAC,IAFY,CAEP,cAFO;QAGf,YAAA,GAAe,CAAA,CAAE,IAAF,CACb,CAAC,OADY,CACJ,cADI,CAEb,CAAC,QAFY,CAEH,SAFG,CAGb,CAAC,QAHY,CAGH,KAHG,CAIb,CAAC,IAJY,CAIP,KAJO;QAKf,WAAA,GAAc,CAAA,CAAE,IAAF,CACZ,CAAC,OADW,CACH,cADG,CAEZ,CAAC,QAFW,CAEF,eAFE,CAGZ,CAAC,QAHW,CAGF,UAHE,CAIZ,CAAC,IAJW,CAAA,CAKZ,CAAC,IALW,CAAA;eAQd,QAAQ,CAAC,MAAT,CACE;UAAA,KAAA,EAAO,qCAAA,GAAwC,YAA/C;UACA,GAAA,EAAK,+CAAA,GAAkD,YADvD;UAEA,WAAA,EAAa,WAFb;SADF;MAzB+B,CAAjC;aA8BA,CAAA,CAAE,oBAAF,CAAuB,CAAC,KAAxB,CAA8B,SAAA;AAC5B,YAAA;QAAA,QAAA,GAAW;QACX,QAAA,IAAY;QACZ,QAAA,IAAY;QACZ,QAAA,IAAY,eAAA,GAAkB,kBAAA,CAAmB,8CAAnB;QAC9B,QAAA,IAAY;QACZ,QAAA,IAAY;QACZ,QAAA,IAAY;QACZ,QAAA,IAAY;QACZ,QAAA,IAAY;QACZ,QAAA,IAAY,UAAA,GAAW,kBAAA,CAAmB,2CAAnB;QACvB,QAAA,IAAY;QACZ,QAAA,IAAY;QACZ,QAAA,IAAY;QACZ,QAAA,IAAY;eACZ,MAAM,CAAC,IAAP,CAAY,QAAZ,EAAsB,6BAAtB,EAAqD,gBAArD;MAf4B,CAA9B;IAjCgD,CAAlD;IAmDA,QAAA,GAAW,CAAA,CAAE,cAAF;IACX,WAAA,GAAc,CAAA,CAAE,oBAAF;IACd,YAAA,GAAe,CAAA,CAAE,sBAAF;IACf,UAAA,GAAa,CAAA,CAAE,qBAAF;IACb,SAAA,GAAY,CAAA,CAAE,yBAAF;IACZ,SAAA,GAAY,CAAA,CAAE,oBAAF;IACZ,SAAA,GAAY,CAAA,CAAE,uBAAF;IACZ,SAAA,GAAY,CAAA,CAAE,YAAF;IAEZ,WAAW,CAAC,KAAZ,CAAkB,SAAA;AAMhB,UAAA;MAAA,WAAA,GAAc,CAAA,CAAE,IAAF,CAAO,CAAC,OAAR,CAAgB,cAAhB,CAA+B,CAAC,IAAhC,CAAqC,cAArC;aAGd,CAAC,CAAC,GAAF,CAAM,iBAAA,GAAoB,WAA1B,EAAuC,SAAC,OAAD;QAKrC,UAAU,CAAC,GAAX,CAAe,OAAO,CAAC,KAAvB;QACA,SAAS,CAAC,GAAV,CAAc,OAAO,CAAC,IAAtB;QACA,SAAS,CAAC,GAAV,CAAc,OAAO,CAAC,IAAtB;QACA,SAAS,CAAC,GAAV,CAAc,OAAO,CAAC,IAAtB;QACA,SAAS,CAAC,GAAV,CAAc,OAAO,CAAC,IAAI,CAAC,IAAb,CAAA,CAAmB,CAAC,OAApB,CAA4B,MAA5B,EAAoC,GAApC,CAAd;QAGA,YAAY,CAAC,GAAb,CAAiB,QAAjB;eAIA,CAAA,CAAE,eAAF,CAAmB,CAAA,CAAA,CAAE,CAAC,YAAtB,CAAmC,QAAnC,EAA6C,gBAA7C;MAhBqC,CAAvC;IATgB,CAAlB;WA2BA,CAAA,CAAE,eAAF,CAAkB,CAAC,EAAnB,CAAsB,iBAAtB,EAAyC,SAAA;MAMvC,CAAA,CAAE,eAAF,CAAmB,CAAA,CAAA,CAAE,CAAC,KAAtB,CAAA;aACA,YAAY,CAAC,GAAb,CAAiB,QAAjB;IAPuC,CAAzC;EAtKgB,CAAlB;AAAA","file":"Journeys.js","sourcesContent":["$(document).ready ->\n  # Grid\n  $('.grid').masonry ->\n    itemSelector: '.grid-item',\n    columnWidth: 200\n\n  # Send likes to the server\n  $('.like-button').click((event) ->\n    journey_uuid = $(event.target).parents('.journeyPost').data('journey-uuid')\n    $.ajax '/journeys/like/' + journey_uuid,\n      method: 'post'\n      success: ->\n        console.log 'Liked?'\n  )\n\n  # Sharing pop-up window preferences\n  popupPreferences = 'height=440'\n  popupPreferences += ','\n  popupPreferences += 'width=560'\n  popupPreferences += ','\n  popupPreferences += 'top=' + ((screen.height / 2) - (600 / 2))\n  popupPreferences += ','\n  popupPreferences += 'left=' + ((screen.width / 2) - (560 / 2))\n\n  # Sharing through Facebook\n  $.ajaxSetup cache: true\n  $.getScript 'http://connect.facebook.net/en_US/sdk.js', ->\n    FB.init\n      appId: '1660831194160373'\n      version: 'v2.5'\n    $('#loginbutton,#feedbutton').removeAttr 'disabled'\n    FB.getLoginStatus (response) ->\n      # Now everything has been initialised\n      $('.share-with-facebook').click ->\n        # Fetch the data for the journey\n        # they want to share on Facebook\n        journey_uuid = $(this)\n          .parents('.journeyPost')\n          .data 'journey-uuid'\n        title = $(this)\n          .parents('.journeyPost')\n          .children(':first-of-type')\n          .children('.jp_title')\n          .children('span')\n          .text()\n        creator = $(this)\n          .parents('.journeyPost')\n          .children(':last-of-type')\n          .children('.jp_fname_date')\n          .children('em')\n          .children('a')\n          .text()\n          .trim()\n        header_image = $(this)\n          .parents('.journeyPost')\n          .children('.jp_img')\n          .children('img')\n          .attr 'src'\n        description = $(this)\n          .parents('.journeyPost')\n          .children(':last-of-type')\n          .children('.jp_body')\n          .text()\n          .trim()\n\n        # Let them share the journey on Facebook\n        FB.ui\n          method: 'feed'\n          link: 'travelingchildrenproject.com/journeys#' + journey_uuid\n          name: creator + '\\'s Journey to ' + title\n          description: description\n          picture: 'http://travelingchildrenproject.com' + header_image\n\n  # Sharing through Twitter\n  $('.share-with-twitter').click ->\n    sharingUrl = $(this).data 'sharing-url'\n    window.open sharingUrl, 'Tweet About This Journey', popupPreferences\n\n  # Sharing through Pinterest\n  $.getScript '//assets.pinterest.com/js/pinit.js', ->\n    # The script has loaded; Attach\n    # the 'click' event listener\n    $('.share-with-pinterest').click ->\n      # Fetch the data for the journey\n      # they want to share on Pinterest\n      #\n      # This data comes from the DOM\n      # because pop-ups are blocked\n      # when they are triggered by\n      # asynchronous requests\n      #\n      journey_uuid = $(this)\n        .parents('.journeyPost')\n        .data 'journey-uuid'\n      header_image = $(this)\n        .parents('.journeyPost')\n        .children('.jp_img')\n        .children('img')\n        .attr 'src'\n      description = $(this)\n        .parents('.journeyPost')\n        .children(':last-of-type')\n        .children('.jp_body')\n        .text()\n        .trim()\n\n      # The user clicked the 'Pinterest' button\n      PinUtils.pinOne\n        media: 'http://travelingchildrenproject.com' + header_image\n        url: 'http://travelingchildrenproject.com/journeys#' + journey_uuid\n        description: description\n\n    $('.share-with-tumblr').click ->\n      postLink = 'https://www.tumblr.com/share?'\n      postLink += 'shareSource=legacy'\n      postLink += '&'\n      postLink += 'cononicalUrl=' + encodeURIComponent('http://travelingchildrenproject.com/journeys')\n      postLink += '&'\n      postLink += 'posttype=link'\n      postLink += '&'\n      postLink += 'tags=TravelingChildrenProject,TCPJourneys'\n      postLink += '&'\n      postLink += 'content='+encodeURIComponent('http://beta.travelingchildrenproject.com/')\n      postLink += '&'\n      postLink += 'caption=TCPJourneyBySomeone'\n      postLink += '&'\n      postLink += 'show-via=travelingchildrenproject'\n      window.open postLink, 'Post This Journey to Tumblr', popupPreferences\n\n  # Handling journey post updates\n  journeys = $('.journeyPost')\n  editButtons = $('.journeyEditButton')\n  submitButton = $('input[type=\"submit\"]')\n  titleField = $('input[name=\"title\"]')\n  uuidField = $('input[name=\"post-uuid\"]')\n  dateField = $('input[name=\"date\"]')\n  bodyField = $('textarea[name=\"body\"]')\n  tagsField = $('input#tags')\n\n  editButtons.click ->\n    # The 'Edit' button was\n    # clicked, so we'll get\n    # the 'UUID' for the\n    # relative journey\n    #\n    journeyUUID = $(this).parents('.journeyPost').data 'journey-uuid'\n\n    # Ask the server for journey data as JSON\n    $.get '/journeys/show/' + journeyUUID, (journey) ->\n      # The server has sent the JSON; Fill\n      # the edit forms' fields with it\n\n      # Fill the fields\n      titleField.val journey.title\n      uuidField.val journey.uuid\n      dateField.val journey.date\n      bodyField.val journey.body\n      tagsField.val journey.tags.trim().replace(/\\s+/g, ' ')\n\n      # Change the form submission button text\n      submitButton.val 'Update'\n\n      # Set the forms' 'action' to the method that\n      # persists the updated data to the database\n      $('.journey-form')[0].setAttribute 'action', '/journeys/edit'\n\n  $('#journeyModal').on 'hidden.bs.modal', () ->\n    # The modal is hiding, so we'll\n    # replace the 'Create' text of\n    # the other forms' button and\n    # clear the form data\n    #\n    $('.journey-form')[0].reset()\n    submitButton.val 'Create'\n"],"sourceRoot":"/source/"}